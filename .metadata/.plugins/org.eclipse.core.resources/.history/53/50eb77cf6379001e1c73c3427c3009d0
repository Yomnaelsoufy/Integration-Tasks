package com.example.main.api.router;

import org.apache.camel.Exchange;
import org.apache.camel.builder.RouteBuilder;
import org.springframework.stereotype.Component;

import com.example.main.api.processor.*;

@Component
public class ThirdServiceRouter extends RouteBuilder {

    @Override
    public void configure() throws Exception {
        from("direct:thirdService")
            .to("jdbc:myDataSource")
            .setHeader(Exchange.HTTP_METHOD, constant("PUT"))
            .setBody(simple("{\"isTahakookVerified\": ${header.isTahakookVerified}, \"newMobileNumber\":${header.mobileNumber} , \"poi\": {\"poiNumber\": ${header.IDNumber}, \"poiType\":${header.IDType}}}"))
            .log("second req : ${body}")
            .to("http://localhost:8082/v1/consumers/mobile?bridgeEndpoint=true")
            .log("Third Service call Response ${body}")
            .process(new ThirdApiResponseProcessor())
            .choice()
                .when(simple("${header.CamelHttpResponseCode} == 200 && ${header.ResponseStatusCode} == 'I000000'"))
                    .to("direct:fourthService")
                .otherwise()
                    .log("Failed to Update mobile number");
    }
}
